{"version":3,"sources":["components/AppButton.tsx","features/login/LoginPrompt.tsx","app/hooks.ts","features/math/algorithms.ts","features/math/visualization/Visualization.tsx","features/math/mathAPI.ts","features/math/mathSlice.ts","features/login/loginAPI.ts","features/login/loginSlice.ts","features/login/Login.tsx","features/math/visualization/helpers/draw.ts","features/math/visualization/simulation/index.ts","features/math/visualization/simulation/gravity.ts","features/math/Math.tsx","features/math/Statement.tsx","features/math/InfoContainer.tsx","features/math/visualization/helpers/transform.ts","features/math/visualization/VisualizationContainer.tsx","components/About.tsx","features/control/ControlPanel.tsx","features/search/searchSlice.ts","features/search/Search.tsx","components/Layout.tsx","App.tsx","app/store.ts","reportWebVitals.ts","index.tsx"],"names":["AppButton","styled","children","className","props","classNames","LoginPrompt","onLogin","useState","promptOpen","setPromptOpen","localStorage","getItem","idp","setIdp","isOpen","onRequestClose","contentLabel","overlayClassName","base","afterOpen","beforeClose","closeTimeoutMS","onClick","onSubmit","e","preventDefault","setItem","id","type","value","onChange","newValue","currentTarget","placeholder","useAppDispatch","useDispatch","useAppSelector","useSelector","old","prune","input","graph","graphlib","Graph","Object","values","forEach","node","setNode","uri","dependencies","dependency","setEdge","output","fromEntries","entries","map","alg","isAcyclic","Error","edges","edge","removeEdge","dijkstra","v","w","distance","Infinity","pruneCore","source","target","fetchGraph","a","getSolidDataset","fetch","dataset","things","getThingAll","nodes","links","thing","asUrl","getTerm","rdf","description","label","rdfs","push","en","dependents","examples","created","updated","proofs","getTermAll","findMathDocumentsOfPerson","webId","me","getThing","publicTypeIndex","solid","index","mathDocuments","filter","forClass","includes","instance","flat","addDocuments","createAsyncThunk","dispatch","api","documents","doc","addGraph","mathSlice","createSlice","name","initialState","entities","byId","allIds","document","ui","highlighted","selected","reducers","highlight","state","action","payload","select","extraReducers","builder","addCase","fulfilled","dependent","actions","selectGraph","createSelector","math","enrichedNodes","enrichedNode","selectPrunedGraph","selectHighlighted","selectSelected","selectSelectedNodeDependencies","selectSelectedNode","init","handleIncomingRedirect","url","window","location","href","restorePreviousSession","sessionInfo","login","oidcIssuer","solidLogin","redirectUrl","clientName","alert","removeItem","logout","solidLogout","_","response","isLoggedIn","loginSlice","status","pending","selectSession","selectLoginStatus","ListItem","li","UserMenu","user","onLogout","open","setOpen","style","position","flexDirection","display","alignItems","zIndex","onMouseLeave","onBlur","event","contains","relatedTarget","onMouseEnter","onFocus","width","height","right","overflow","Login","info","disabled","drawText","context","text","options","x","y","font","textBaseline","textAlign","assign","fillText","drawCircle","radius","beginPath","arc","Math","PI","fill","drawLine","start","end","moveTo","lineTo","stroke","Visualization","grid","onTransform","onHover","onSelectNode","canvasEl","useRef","setVisualizationSize","useEffect","current","getContext","offset","save","translate","clearRect","strokeStyle","min1","max1","min0","max0","getLineWidth","i","origin","lineWidth","drawGrid","link","s","t","numeric","sub","size","sqrt","div","add","mul","r","color","accented","focused","focused2","rest","fillStyle","drawGraph","restore","updateCanvasSize","elementRef","clientHeight","clientWidth","getElementSize","addEventListener","removeEventListener","call","drag","clickDistance","on","dx","dy","zoom","scaleExtent","transform","k","dot","inv","withCanvasPosition","func","rect","getBoundingClientRect","clientX","left","clientY","top","handleMouseMove","handleClick","ref","onMouseMove","onMouseOut","classnames","Simulation","runs","simulation","forceSimulation","alphaDecay","force","forceLink","strength","alpha","d","vy","optimumDifference","forceGravity","forceManyBody","distanceMax","forceX","forceY","forceCollide","forceCenter","stop","onTick","restart","update","thisNodeDict","updatedNodes","random","selectNode","find","Styler","remarkPlugins","remarkMath","rehypePlugins","rehypeKatex","NodeList","title","length","Statement","ICOutside","ICInside","InfoContainer","matrix","vector","raw","transpose","nodeRadius","count","basicGrid","VisualizationContainer","prunedGraph","highlightedNode","selectedNode","selectedNodeDependencies","layout","setLayout","setMatrix","lastUpdate","Date","now","reduce","keys","withNode","handleHover","handleSelect","transformedLayout","selectedDependencies","transformedNodesDict","sourceUri","targetUri","transformLayout","transformGrid","prevMatrix","Link","Footer","footer","About","ControlPanel","searchSlice","query","setSearch","selectSearch","search","selectSearchResults","toLowerCase","sort","b","slice","Search","clear","useCallback","handleEsc","key","autoFocus","PositionedAbout","FullSizeVisualization","TopNav","nav","Layout","App","initLogin","store","configureStore","reducer","loginReducer","mathReducer","searchReducer","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","appElement","querySelector","Modal","setAppElement","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.e40876b3.chunk.js","sourcesContent":["/** These are the main buttons of the application */\n\nimport React from 'react'\nimport styled from 'styled-components'\nimport classNames from 'classnames'\n\ntype ButtonProps = React.ButtonHTMLAttributes<HTMLButtonElement>\n\nconst Button: React.FC<ButtonProps> = ({\n  children,\n  className,\n  ...props\n}: ButtonProps) => {\n  return (\n    <button className={classNames(className, 'button')} {...props}>\n      {children}\n    </button>\n  )\n}\n\nconst AppButton = styled(Button)`\n  &:not(:hover) {\n    background-color: #0000;\n    border-color: #0000;\n    color: #fff;\n  }\n  &:hover {\n  }\n  &:active {\n    background-color: #eee;\n  }\n`\n\nexport default AppButton\n","import React, { useState } from 'react'\nimport Modal from 'react-modal'\nimport AppButton from '../../components/AppButton'\n\ninterface Props {\n  onLogin: (oidcIssuer: string) => void\n}\n\nconst LoginPrompt: React.FC<Props> = ({ onLogin, ...props }: Props) => {\n  const [promptOpen, setPromptOpen] = useState(false)\n  const [idp, setIdp] = useState(\n    localStorage.getItem('idp') ?? 'https://solidcommunity.net',\n  )\n\n  const onSubmit: React.FormEventHandler = e => {\n    e.preventDefault()\n    localStorage.setItem('idp', idp)\n    onLogin(idp)\n  }\n\n  const onChangeInput = (e: React.FormEvent<HTMLInputElement>) => {\n    e.preventDefault()\n    const newValue = e.currentTarget.value\n    setIdp(newValue)\n  }\n\n  if (!promptOpen) {\n    return (\n      <>\n        <AppButton\n          {...props}\n          onClick={e => {\n            e.preventDefault()\n            setPromptOpen(true)\n          }}\n        >\n          Login\n        </AppButton>\n      </>\n    )\n  }\n\n  return (\n    <>\n      <Modal\n        isOpen={promptOpen}\n        onRequestClose={() => setPromptOpen(false)}\n        contentLabel=\"Connect your Solid Pod\"\n        overlayClassName={{\n          base: 'modal modal-background is-active',\n          afterOpen: '',\n          beforeClose: '',\n        }}\n        className={{\n          base: 'modal-content',\n          afterOpen: '',\n          beforeClose: '',\n        }}\n        closeTimeoutMS={50}\n      >\n        <button className=\"modal-close\" onClick={() => setPromptOpen(false)}>\n          close\n        </button>\n\n        <div className=\"card\">\n          <header className=\"card-header\">\n            <p className=\"card-header-title\">\n              Select your Solid identity provider\n            </p>\n          </header>\n          <div className=\"card-content\">\n            <form onSubmit={onSubmit}>\n              <div className=\"field\">\n                <div className=\"control\">\n                  <input\n                    id=\"idp\"\n                    className=\"input\"\n                    type=\"url\"\n                    value={idp}\n                    onChange={onChangeInput}\n                    placeholder=\"Where is your Solid Pod?\"\n                  />\n                </div>\n              </div>\n              <div className=\"field\">\n                <div className=\"control\">\n                  <input\n                    type=\"submit\"\n                    value=\"Connect\"\n                    className=\"button is-link\"\n                  />\n                </div>\n              </div>\n            </form>\n          </div>\n        </div>\n      </Modal>\n    </>\n  )\n}\n\nexport default LoginPrompt\n","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\nimport type { RootState, AppDispatch } from './store'\n\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\n","import graphlib, { Graph } from 'graphlib'\n// import { Dependency } from './simulation/types'\n// import findCyclesAdjacency from 'elementary-circuits-directed-graph'\nimport { Graph as AbstractGraph } from './types'\n\nfunction pruneCore(graph: Graph) {\n  if (!graphlib.alg.isAcyclic(graph)) {\n    // const cycles = graphlib.alg.findCycles(graph);\n    throw new Error('pruning is possible on DAG only')\n  }\n  const edges = graph.edges()\n  edges.forEach(edge => {\n    // remove edge\n    graph.removeEdge(edge)\n    // see if another path exists\n    const paths = graphlib.alg.dijkstra(graph, edge.v)\n    // if the other path doesn't exist, add the node back\n    if (paths[edge.w].distance === Infinity) {\n      graph.setEdge(edge)\n    }\n  })\n  return graph\n}\n\nexport const prune = (input: AbstractGraph): AbstractGraph => {\n  const graph = new graphlib.Graph()\n\n  Object.values(input).forEach(node => {\n    graph.setNode(node.uri)\n\n    Object.values(node.dependencies).forEach(dependency =>\n      graph.setEdge(node.uri, dependency.uri),\n    )\n  })\n\n  const output: AbstractGraph = Object.fromEntries(\n    Object.entries(input).map(([uri, node]) => [\n      uri,\n      { ...node, dependencies: {} },\n    ]),\n  )\n\n  const prunedEdges = pruneCore(graph)\n    .edges()\n    .map(({ v: source, w: target }) => ({ source, target }))\n\n  prunedEdges.forEach(({ source, target }) => {\n    output[source].dependencies[target] = output[target]\n  })\n\n  return output\n}\n\n/*\nexport function getCycles(dependencies: Dependency[]): Dependency[][] {\n  const nodes = Array.from(\n    new Set([\n      ...dependencies.map(d => d.dependent),\n      ...dependencies.map(d => d.dependency),\n    ]),\n  )\n  const nodeIndexes = Object.fromEntries(\n    Object.entries(nodes).map(([key, value]) => [value, +key]),\n  )\n\n  const adjacency = Array(nodes.length)\n    .fill(null)\n    .map(() => [] as number[])\n  dependencies.forEach(({ dependent, dependency }) => {\n    const dependentIndex = nodeIndexes[dependent]\n    const dependencyIndex = nodeIndexes[dependency]\n    adjacency[dependentIndex].push(dependencyIndex)\n  })\n\n  // try to detect loops (cycles of length 1)\n  // this is due to the limits of the findCyclesAdjacency, which fails to detect loops\n  // https://github.com/antoinerg/elementary-circuits-directed-graph/issues/13\n  // @TODO remove loop detection when the issue is fixed\n  const loops = adjacency.reduce((loops, adj, i) => {\n    if (adj.includes(i)) loops.push([i, i])\n    return loops\n  }, [] as number[][])\n\n  const rawCycles = loops.length > 0 ? loops : findCyclesAdjacency(adjacency)\n\n  const simpleCycles = rawCycles.map(cycle =>\n    cycle.slice(0, -1).map(i => nodes[i]),\n  )\n\n  return simpleCycles\n    .map(cycle => simpleCycleToCycle(cycle, dependencies))\n    .sort((a, b) => a.length - b.length)\n    .slice(0, 5)\n}\n\nfunction simpleCycleToCycle(\n  simpleCycle: string[],\n  dependencies: Dependency[],\n): Dependency[] {\n  return simpleCycle.map((uri, index) => {\n    const dependent = simpleCycle[index]\n    const dependency = simpleCycle[(index + 1) % simpleCycle.length]\n    return (\n      dependencies.find(\n        d => d.dependency === dependency && d.dependent === dependent,\n      ) || {\n        dependent,\n        dependency,\n        doc: '',\n      }\n    )\n  })\n  }\n  */\n","import React, { useRef, useEffect, useState } from 'react'\nimport { drawGrid, drawGraph } from './helpers/draw'\nimport classnames from 'classnames'\nimport { drag } from 'd3-drag'\nimport { zoom } from 'd3-zoom'\nimport { select } from 'd3-selection'\nimport numeric from 'numeric'\nimport { VisualizationGraph, Vector, Grid, Matrix } from './types'\n\ntype Props = Partial<React.CanvasHTMLAttributes<HTMLCanvasElement>> & {\n  graph: VisualizationGraph\n  grid: Grid\n  onTransform: (matrix: Matrix) => void\n  onHover: (position: Vector) => void\n  onSelectNode: (position: Vector) => void\n}\n\nlet old: Matrix\n\nconst Visualization: React.FC<Props> = ({\n  graph,\n  grid,\n  onTransform,\n  onHover,\n  onSelectNode,\n  ...props\n}: Props) => {\n  const canvasEl = useRef<HTMLCanvasElement>(null)\n  const [{ width, height }, setVisualizationSize] = useState({\n    width: 0,\n    height: 0,\n  })\n\n  useEffect(() => {\n    if (canvasEl && canvasEl.current) {\n      const context = canvasEl.current.getContext('2d')\n      if (context) {\n        const offset: Vector = [width / 2, height / 2]\n        context.save()\n        context.translate(...offset)\n        context.clearRect(-offset[0], -offset[1], width, height)\n        drawGrid(context, grid, width, height, offset)\n        drawGraph(context, graph)\n        return () => context.restore()\n      }\n    }\n  }, [width, height, graph, canvasEl, grid])\n\n  useEffect(() => {\n    const updateCanvasSize = () => {\n      if (canvasEl && canvasEl.current) {\n        const size = getElementSize(canvasEl)\n        setVisualizationSize(size)\n      }\n    }\n\n    updateCanvasSize()\n    window.addEventListener('load', updateCanvasSize)\n    window.addEventListener('resize', updateCanvasSize)\n\n    return () => {\n      window.removeEventListener('resize', updateCanvasSize)\n      window.removeEventListener('load', updateCanvasSize)\n    }\n  }, [width, height, canvasEl])\n\n  useEffect(() => {\n    if (canvasEl && canvasEl.current) {\n      select(canvasEl.current).call(\n        drag<HTMLCanvasElement, unknown>()\n          .clickDistance(2)\n          //.on('start', console.log)\n          .on('drag', e => {\n            onTransform([\n              [1, 0, e.dx],\n              [0, 1, e.dy],\n              [0, 0, 1],\n            ])\n          }),\n        //.on('end', console.log),\n      )\n\n      select(canvasEl.current).call(\n        zoom<HTMLCanvasElement, unknown>()\n          .clickDistance(2)\n          .scaleExtent([0.05, 3])\n          .on('zoom', e => {\n            old = old ?? [\n              [1, 0, -width / 2],\n              [0, 1, -height / 2],\n              [0, 0, 1],\n            ]\n            const { x, y, k } = e.transform\n\n            const zoom = [\n              [k, 0, x - width / 2],\n              [0, k, y - height / 2],\n              [0, 0, 1],\n            ]\n\n            const transform = numeric.dot(zoom, numeric.inv(old)) as Matrix\n            old = zoom\n\n            onTransform(transform)\n          }),\n      )\n    }\n  }, [canvasEl, onTransform, height, width])\n\n  const withCanvasPosition =\n    (\n      func: (position: Vector) => void,\n    ): React.MouseEventHandler<HTMLCanvasElement> =>\n    e => {\n      // https://stackoverflow.com/a/42111623\n      if (canvasEl && canvasEl.current) {\n        const rect = canvasEl.current.getBoundingClientRect()\n        const x = e.clientX - rect.left //x position within the element.\n        const y = e.clientY - rect.top //y position within the element.\n        func([x - width / 2, y - height / 2])\n      }\n    }\n\n  const handleMouseMove = withCanvasPosition(onHover)\n  const handleClick = withCanvasPosition(onSelectNode)\n\n  return (\n    <canvas\n      {...props}\n      ref={canvasEl}\n      onMouseMove={handleMouseMove}\n      // @TODO this piece is very inefficient, we search for a nonexistent node, just to unhighlight everything; but it works\n      onMouseOut={() => onHover([Infinity, Infinity])}\n      width={width}\n      height={height}\n      className={classnames(props.className, 'has-background-dark')}\n      onClick={handleClick}\n    />\n  )\n}\n\nexport default Visualization\n\nfunction getElementSize(elementRef: React.RefObject<HTMLCanvasElement>) {\n  if (elementRef && elementRef.current) {\n    const { clientHeight: height, clientWidth: width } = elementRef.current\n    return { height, width }\n  } else return { height: 0, width: 0 }\n}\n","import {\n  getSolidDataset,\n  UrlString,\n  getThingAll,\n  getTermAll,\n  getTerm,\n  getThing,\n  asUrl,\n} from '@inrupt/solid-client'\nimport { fetch } from '@inrupt/solid-client-authn-browser'\nimport { rdf, rdfs, solid } from 'rdf-namespaces'\nimport { Definition, Statement } from './types'\n\ninterface Graph {\n  nodes: (Definition | Statement)[]\n  links: [string, string][]\n}\n\nexport const fetchGraph = async (uri: UrlString): Promise<Graph> => {\n  const dataset = await getSolidDataset(uri, { fetch })\n  const things = getThingAll(dataset)\n  const graph: Graph = { nodes: [], links: [] }\n  things.forEach(thing => {\n    const uri = asUrl(thing)\n    const type = getTerm(thing, rdf.type)?.value ?? ''\n    const description = getTerm(thing, rdf.value)?.value ?? ''\n    const label = getTerm(thing, rdfs.label)?.value ?? ''\n    switch (type) {\n      case 'https://terms.math.livegraph.org#Definition':\n        graph.nodes.push({\n          id: uri,\n          type: 'definition',\n          label: { en: label },\n          description: { en: description },\n          dependencies: [],\n          dependents: [],\n          examples: [],\n          created: 0,\n          updated: 0,\n        })\n        break\n      case 'https://terms.math.livegraph.org#Statement':\n        graph.nodes.push({\n          id: uri,\n          type: 'statement',\n          label: { en: label },\n          description: { en: description },\n          dependencies: [],\n          dependents: [],\n          examples: [],\n          proofs: [],\n          created: 0,\n          updated: 0,\n        })\n        break\n      default:\n        break\n    }\n    getTermAll(thing, 'https://terms.math.livegraph.org#dependsOn').forEach(\n      dependency => {\n        graph.links.push([uri, dependency.value])\n      },\n    )\n  })\n  return graph\n}\n\nexport const findMathDocumentsOfPerson = async (\n  webId: string,\n): Promise<string[]> => {\n  if (webId) {\n    const dataset = await getSolidDataset(webId, { fetch })\n    const me = getThing(dataset, webId)\n    if (me) {\n      const publicTypeIndex = getTerm(me, solid.publicTypeIndex)?.value\n      if (publicTypeIndex) {\n        const index = await getSolidDataset(publicTypeIndex, { fetch })\n        const things = getThingAll(index)\n        const mathDocuments = things\n          .filter(thing =>\n            getTermAll(thing, solid.forClass)\n              .map(a => a.value)\n              .includes('https://terms.math.livegraph.org#Definition'),\n          )\n          .map(thing => getTermAll(thing, solid.instance))\n          .flat()\n          .map(a => a.value)\n        return mathDocuments\n      }\n    }\n  }\n  return ['https://mrkvon.solidcommunity.net/public/math/graph-theory.ttl']\n}\n","import {\n  createSlice,\n  createAsyncThunk,\n  createSelector,\n  PayloadAction,\n} from '@reduxjs/toolkit'\nimport { prune } from './algorithms'\nimport { RootState } from '../../app/store'\nimport * as api from './mathAPI'\nimport { Definition, Statement, Graph, MathDocument } from './types'\nimport { Entity } from '../../types'\n\nexport interface MathState {\n  entities: {\n    node: Entity<Definition | Statement>\n    document: Entity<MathDocument>\n    // we'll add examples and proofs and citations here\n  }\n  ui: {\n    highlighted: string\n    selected: string\n  }\n}\n\nconst initialState: MathState = {\n  entities: {\n    node: {\n      byId: {},\n      allIds: [],\n    },\n    document: {\n      byId: {},\n      allIds: [],\n    },\n  },\n  ui: {\n    highlighted: '',\n    selected: '',\n  },\n}\n\n// Thunks\nexport const addDocuments = createAsyncThunk(\n  'math/addDocuments',\n  async (webId: string, { dispatch }) => {\n    const documents = await api.findMathDocumentsOfPerson(webId)\n    documents.forEach(doc => dispatch(addGraph(doc)))\n    return documents\n  },\n)\n\nexport const addGraph = createAsyncThunk(\n  'math/addGraph',\n  async (uri: string) => {\n    return await api.fetchGraph(uri)\n  },\n)\n\nexport const mathSlice = createSlice({\n  name: 'math',\n  initialState,\n  reducers: {\n    highlight: (state, action: PayloadAction<string>) => {\n      state.ui.highlighted = action.payload\n    },\n    select: (state, action: PayloadAction<string>) => {\n      state.ui.selected = action.payload\n    },\n  },\n  extraReducers: builder => {\n    builder\n      .addCase(addDocuments.fulfilled, (state, action) => {\n        state.entities.document = {\n          byId: Object.fromEntries(action.payload.map(id => [id, { id }])),\n          allIds: action.payload,\n        }\n      })\n      .addCase(addGraph.fulfilled, (state, action) => {\n        const { nodes, links } = action.payload\n        nodes.forEach(node => {\n          state.entities.node.byId[node.id] = node\n          state.entities.node.allIds.push(node.id)\n        })\n        links.forEach(([dependent, dependency]) => {\n          state.entities.node.byId[dependent].dependencies.push(dependency)\n          state.entities.node.byId[dependency].dependents.push(dependent)\n        })\n      })\n  },\n})\n\nexport const { highlight, select } = mathSlice.actions\n\n// Selectors\nconst selectGraphNodes = (state: RootState) => state.math.entities.node\n\nexport const selectGraph = createSelector(selectGraphNodes, ({ byId }) => {\n  const enrichedNodes: Graph = Object.fromEntries(\n    Object.entries(byId).map(([id, { id: uri, ...node }]) => [\n      id,\n      {\n        ...node,\n        uri,\n        dependencies: {},\n        dependents: {},\n      },\n    ]),\n  )\n\n  Object.entries(enrichedNodes).forEach(([id, enrichedNode]) => {\n    enrichedNode.dependencies = Object.fromEntries(\n      byId[id].dependencies.map(id => [id, enrichedNodes[id]]),\n    )\n    enrichedNode.dependents = Object.fromEntries(\n      byId[id].dependents.map(id => [id, enrichedNodes[id]]),\n    )\n  })\n\n  return enrichedNodes\n})\n\nexport const selectPrunedGraph = createSelector(selectGraph, graph =>\n  prune(graph),\n)\n\nexport const selectHighlighted = (state: RootState) => state.math.ui.highlighted\nexport const selectSelected = (state: RootState) => state.math.ui.selected\n\nconst selectNodeDependencies = (uri: string, graph: Graph): string[] =>\n  uri ? Object.values(graph[uri]?.dependencies ?? {}).map(node => node.uri) : []\n\nexport const selectSelectedNodeDependencies = createSelector(\n  selectSelected,\n  selectGraph,\n  selectNodeDependencies,\n)\n\nexport const selectSelectedNode = createSelector(\n  selectSelected,\n  selectGraph,\n  (uri, graph) => graph[uri],\n)\n\nexport default mathSlice.reducer\n","import {\n  login as solidLogin,\n  logout as solidLogout,\n  handleIncomingRedirect,\n} from '@inrupt/solid-client-authn-browser'\n\nexport const init = async () => {\n  const sessionInfo = await handleIncomingRedirect({\n    url: window.location.href,\n    restorePreviousSession: true,\n  })\n  return sessionInfo\n}\n\nexport const login = async (oidcIssuer: string) => {\n  try {\n    await solidLogin({\n      oidcIssuer,\n      redirectUrl: window.location.href,\n      clientName: 'Friends Crawler',\n    })\n  } catch (error) {\n    alert(`Could not find a Solid Pod at ${oidcIssuer}`)\n    localStorage.removeItem('idp')\n  }\n}\n\nexport const logout = async () => {\n  await solidLogout()\n}\n","import { createAsyncThunk, createSlice } from '@reduxjs/toolkit'\nimport { RootState } from '../../app/store'\nimport { addDocuments } from '../math/mathSlice'\nimport * as api from './loginAPI'\n\n// State\nexport interface LoginState {\n  webId: string\n  isLoggedIn: boolean\n  status: 'idle' | 'loading' | 'failed'\n}\n\nconst initialState: LoginState = {\n  webId: '',\n  isLoggedIn: false,\n  status: 'loading',\n}\n\n// Thunks\nexport const init = createAsyncThunk('login/init', async (_, { dispatch }) => {\n  const response = await api.init()\n  const webId = response?.webId ?? ''\n  const isLoggedIn = response?.isLoggedIn ?? false\n  dispatch(addDocuments(webId))\n  return { webId, isLoggedIn }\n})\n\nexport const login = createAsyncThunk(\n  'login/login',\n  async (oidcIssuer: string) => {\n    await api.login(oidcIssuer)\n  },\n)\n\nexport const logout = createAsyncThunk('login/logout', async () => {\n  await api.logout()\n})\n\n// Slice\nexport const loginSlice = createSlice({\n  name: 'login',\n  initialState,\n  reducers: {},\n  extraReducers: builder => {\n    builder\n      .addCase(init.pending, state => {\n        state.status = 'loading'\n      })\n      .addCase(init.fulfilled, (state, action) => {\n        state.status = 'idle'\n        state.webId = action.payload.webId\n        state.isLoggedIn = action.payload.isLoggedIn\n      })\n      .addCase(login.pending, state => {\n        state.status = 'loading'\n      })\n      .addCase(login.fulfilled, state => {\n        state.status = 'idle'\n      })\n      .addCase(logout.pending, state => {\n        state.status = 'loading'\n      })\n      .addCase(logout.fulfilled, state => {\n        state.status = 'idle'\n        state.webId = ''\n        state.isLoggedIn = false\n      })\n  },\n})\n\n// Selectors\nexport const selectSession = (state: RootState) => ({\n  webId: state.login.webId,\n  isLoggedIn: state.login.isLoggedIn,\n})\n\nexport const selectLoginStatus = (state: RootState) => state.login.status\n\nexport default loginSlice.reducer\n","import React, { useState } from 'react'\nimport LoginPrompt from './LoginPrompt'\nimport { useAppDispatch, useAppSelector } from '../../app/hooks'\nimport { login, logout, selectLoginStatus, selectSession } from './loginSlice'\nimport AppButton from '../../components/AppButton'\nimport classNames from 'classnames'\nimport styled from 'styled-components'\n\ninterface User {\n  webId: string\n}\n\nconst ListItem = styled.li`\n  display: flex;\n  background-color: white;\n  > * {\n    flex: auto;\n    padding: 0.5rem;\n    border: none;\n    &:hover {\n      background-color: lightgray;\n    }\n  }\n`\n\nconst UserMenu = ({\n  user,\n  onLogout,\n  className,\n  ...props\n}: {\n  user: User\n  onLogout: () => void\n  className?: string\n}) => {\n  const [open, setOpen] = useState(false)\n\n  return (\n    <div\n      {...props}\n      className={classNames(className)}\n      style={{\n        position: 'relative',\n        flexDirection: 'column',\n        display: 'inline-flex',\n        alignItems: 'end',\n        zIndex: 3,\n      }}\n      onMouseLeave={() => setOpen(false)}\n      onBlur={event => {\n        // https://stackoverflow.com/a/60094794\n        // make sure the blur works when leaving the whole thing only\n        if (!event.currentTarget.contains(event.relatedTarget as Node)) {\n          setOpen(false)\n        }\n      }}\n    >\n      <AppButton\n        onMouseEnter={() => setOpen(true)}\n        onFocus={() => setOpen(true)}\n      >\n        <i className=\"icon icon-user\" />\n      </AppButton>\n      {open && (\n        <div style={{ position: 'relative', width: 0, height: 0 }}>\n          <div\n            className=\"box p-0\"\n            style={{ position: 'absolute', right: 0, overflow: 'hidden' }}\n          >\n            <div className=\"menu box p-0\">\n              <ul className=\"menu-list\">\n                <ListItem>\n                  <span>{user.webId}</span>\n                </ListItem>\n                <ListItem>\n                  <button className=\"button\" onClick={onLogout}>\n                    Logout\n                  </button>\n                </ListItem>\n              </ul>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nconst Login = ({ ...props }) => {\n  const dispatch = useAppDispatch()\n  const info = useAppSelector(selectSession)\n  const status = useAppSelector(selectLoginStatus)\n\n  return status === 'loading' ? (\n    <AppButton {...props} disabled>\n      <i className=\"icon icon-spinner animate-pulse\" />\n    </AppButton>\n  ) : info.isLoggedIn ? (\n    <UserMenu user={info} {...props} onLogout={() => dispatch(logout())} />\n  ) : (\n    <LoginPrompt\n      {...props}\n      onLogin={oidcIssuer => dispatch(login(oidcIssuer))}\n    />\n  )\n}\n\nexport default Login\n","import { Vector, Grid, VisualizationGraph } from '../types'\nimport numeric from 'numeric'\n\ntype Options = Partial<CanvasRenderingContext2D>\n\nconst drawText = (\n  context: CanvasRenderingContext2D,\n  [x, y]: Vector,\n  text: string,\n  options: Options,\n) => {\n  context.font = '20px Arial'\n  context.textBaseline = 'middle'\n  context.textAlign = 'left'\n  // context.fillStyle = '#fff7'\n  Object.assign(context, options)\n  context.fillText(text, x, y)\n}\n\nconst drawCircle = (\n  context: CanvasRenderingContext2D,\n  [x, y]: Vector,\n  radius: number,\n  options: Options,\n) => {\n  Object.assign(context, options)\n  context.beginPath()\n  context.arc(x, y, radius, 0, 2 * Math.PI)\n  context.fill()\n}\n\nconst drawLine = (\n  context: CanvasRenderingContext2D,\n  start: Vector,\n  end: Vector,\n  options: Options,\n) => {\n  Object.assign(context, options)\n\n  context.beginPath()\n  context.moveTo(...start)\n  context.lineTo(...end)\n  context.stroke()\n}\n\nexport const drawGraph = (\n  context: CanvasRenderingContext2D,\n  graph: VisualizationGraph,\n) => {\n  graph.links.forEach(link => {\n    // we're counting a unit vector to make links that don't overlap nodes\n    // source point\n    const s = [link.source.x, link.source.y]\n    // target point\n    const t = [link.target.x, link.target.y]\n    // vector\n    const v = numeric.sub(t, s)\n    // vector size\n    const size = Math.sqrt(v[0] ** 2 + v[1] ** 2)\n    // unit vector\n    const i = numeric.div(v, size)\n    drawLine(\n      context,\n      // links don't overlap circles\n      numeric.add(s, numeric.mul(i, link.source.r)) as Vector,\n      numeric.sub(t, numeric.mul(i, link.target.r)) as Vector,\n      {\n        strokeStyle: 'white',\n        lineWidth: 0.5,\n      },\n    )\n  })\n\n  const color = {\n    accent: 'violet',\n    focus: 'red',\n    focus2: 'pink',\n    rest: {\n      node: '#fff8',\n      label: '#fff4',\n    },\n  }\n\n  const accented = graph.nodes.filter(({ style }) => style === 'accent')\n  const focused = graph.nodes.filter(({ style }) => style === 'focus')\n  const focused2 = graph.nodes.filter(({ style }) => style === 'focus2')\n  const rest = graph.nodes.filter(({ style }) => !style)\n\n  // draw all the nodes which are not special\n  rest.forEach(({ x, y, r }) =>\n    drawCircle(context, [x, y], r, { fillStyle: color.rest.node }),\n  )\n\n  rest.forEach(({ x, y, r, label }) =>\n    drawText(context, [x + r + 5, y], label, {\n      fillStyle: color.rest.label,\n    }),\n  )\n\n  // draw focused nodes\n  focused2.forEach(({ x, y, r }) =>\n    drawCircle(context, [x, y], r, { fillStyle: color.focus2 }),\n  )\n\n  focused2.forEach(({ x, y, r, label }) =>\n    drawText(context, [x + r + 5, y], label, { fillStyle: color.focus2 }),\n  )\n\n  // draw focused nodes\n  focused.forEach(({ x, y, r }) =>\n    drawCircle(context, [x, y], r, { fillStyle: color.focus }),\n  )\n\n  focused.forEach(({ x, y, r, label }) =>\n    drawText(context, [x + r + 5, y], label, { fillStyle: color.focus }),\n  )\n\n  // draw accented nodes\n  accented.forEach(({ x, y, r }) =>\n    drawCircle(context, [x, y], r, { fillStyle: color.accent }),\n  )\n\n  accented.forEach(({ x, y, r, label }) =>\n    drawText(context, [x + r + 5, y], label, {\n      fillStyle: color.accent,\n    }),\n  )\n}\n\nexport const drawGrid = (\n  context: CanvasRenderingContext2D,\n  grid: Grid,\n  width: number,\n  height: number,\n  offset: Vector = [0, 0],\n) => {\n  const strokeStyle = '#fff2'\n  const min1 = -offset[1]\n  const max1 = height - offset[1]\n  const min0 = -offset[0]\n  const max0 = width - offset[0]\n\n  const getLineWidth = (i: number) =>\n    i === 0 ? 2 : i % grid.highlight === 0 ? 1 : 0.5\n\n  let i = 0\n  while (i * grid.distance + grid.origin[0] <= max0) {\n    const x = i * grid.distance + grid.origin[0]\n    if (x >= min0) {\n      drawLine(context, [x, min1], [x, max1], {\n        strokeStyle,\n        lineWidth: getLineWidth(i),\n      })\n    }\n    i++\n  }\n\n  i = -1\n  while (i * grid.distance + grid.origin[0] >= min0) {\n    const x = i * grid.distance + grid.origin[0]\n    if (x <= max0) {\n      drawLine(context, [x, min1], [x, max1], {\n        strokeStyle,\n        lineWidth: getLineWidth(i),\n      })\n    }\n    i--\n  }\n\n  i = 0\n  while (i * grid.distance + grid.origin[1] <= max1) {\n    const y = i * grid.distance + grid.origin[1]\n    if (y >= min1) {\n      drawLine(context, [min0, y], [max0, y], {\n        strokeStyle,\n        lineWidth: getLineWidth(i),\n      })\n    }\n    i++\n  }\n\n  i = -1\n  while (i * grid.distance + grid.origin[1] >= min1) {\n    const y = i * grid.distance + grid.origin[1]\n    if (y <= max1) {\n      drawLine(context, [min0, y], [max0, y], {\n        strokeStyle,\n        lineWidth: getLineWidth(i),\n      })\n    }\n    i--\n  }\n}\n","import {\n  forceSimulation,\n  forceCollide,\n  forceLink,\n  forceManyBody,\n  forceCenter,\n  forceX,\n  forceY,\n  ForceLink,\n} from 'd3-force'\nimport { Dictionary } from '../../../../types'\nimport forceGravity from './gravity'\nimport {\n  Coords,\n  SimulationNode,\n  SimulationLink,\n  Node,\n  SimulationNodeExt,\n  SimulationLinkExt,\n} from './types'\n\nexport default class Simulation {\n  nodes: SimulationNodeExt[] = []\n  links: SimulationLinkExt[] = []\n\n  runs = false\n\n  simulation = forceSimulation()\n    .alphaDecay(0.005)\n    .force(\n      'link',\n      forceLink()\n        .id(node => (node as SimulationNodeExt).uri)\n        .distance(50)\n        .strength(0.1),\n    )\n    .force('linkGravity', forceGravity().strength(50))\n    .force('charge', forceManyBody().strength(-150).distanceMax(500))\n    .force('gravityX', forceX(0).strength(0.01))\n    .force('gravityY', forceY(0).strength(0.01))\n    .force(\n      'collide',\n      forceCollide(({ r }: SimulationNodeExt) => r + 5),\n    )\n    .force('center', forceCenter(0, 0))\n    .stop()\n\n  start = ({\n    nodes,\n    links,\n    onTick,\n  }: {\n    nodes: SimulationNode[]\n    links: SimulationLink[]\n    onTick: (simulation: {\n      nodes: SimulationNode[]\n      links: SimulationLinkExt[]\n    }) => void\n  }) => {\n    this.nodes = nodes as SimulationNodeExt[]\n    this.links = links.map(link => ({ ...link })) as SimulationLinkExt[]\n\n    this.simulation.nodes(this.nodes)\n    ;(\n      this.simulation.force('link') as ForceLink<\n        SimulationNodeExt,\n        SimulationLinkExt\n      >\n    ).links(this.links)\n    ;(\n      this.simulation.force('linkGravity') as ForceLink<\n        SimulationNodeExt,\n        SimulationLinkExt\n      >\n    ).links(this.links)\n\n    this.simulation.on('tick', () => {\n      onTick({\n        nodes: this.nodes as SimulationNode[],\n        links: this.links,\n      })\n    })\n\n    this.simulation.restart()\n    this.runs = true\n  }\n\n  stop = () => {\n    this.runs = false\n    return this.simulation.stop()\n  }\n\n  update = ({ nodes, links }: { nodes: Node[]; links: SimulationLink[] }) => {\n    this.simulation.stop()\n    // combine current nodes and the old nodes\n    const thisNodeDict: Dictionary<SimulationNodeExt> = Object.fromEntries(\n      this.nodes.map(node => [node.uri, node]),\n    )\n    const updatedNodes: SimulationNodeExt[] = nodes.map(node => ({\n      ...node,\n      x: (0.5 - Math.random()) * 800,\n      y: (0.5 - Math.random()) * 800,\n      ...thisNodeDict[node.uri],\n      r: node.r,\n    }))\n    this.nodes = updatedNodes\n    this.links = links.map(link => ({ ...link })) as SimulationLinkExt[]\n\n    this.simulation.nodes(this.nodes)\n    ;(\n      this.simulation.force('link') as ForceLink<\n        SimulationNodeExt,\n        SimulationLinkExt\n      >\n    ).links(this.links)\n    ;(\n      this.simulation.force('linkGravity') as ForceLink<\n        SimulationNodeExt,\n        SimulationLinkExt\n      >\n    ).links(this.links)\n\n    this.simulation.alpha(1).restart()\n  }\n\n  selectNode = ({ x, y }: Coords) =>\n    this.simulation.find(x, y, 40) as SimulationNodeExt\n}\n","import { SimulationLinkExt } from './types'\n\nexport default function gravity() {\n  let links: SimulationLinkExt[] = []\n  let strength = 3\n  function force(alpha: number) {\n    const k = strength * alpha\n    links.forEach(function (d) {\n      //// this works\n      // d.source.y = Math.max(d.target.y + 50, d.source.y);\n      //// this is original\n      // d.source.vy += k;\n      // d.target.vy -= k;\n      //\n      //// this works with velocities, so the graph looks less layered\n      const { source, target } = d\n      if (typeof source === 'object' && typeof target === 'object') {\n        if (\n          source.y &&\n          target.y &&\n          source.vy &&\n          target.vy &&\n          source.y < target.y + 50\n        ) {\n          const optimumDifference = (target.y + 50 - source.y) / 50\n          source.vy += k * optimumDifference\n          target.vy -= k * optimumDifference\n        }\n      }\n    })\n  }\n\n  force.links = (_: SimulationLinkExt[]) => {\n    links = _\n    return force\n  }\n\n  force.strength = (_: number) => {\n    strength = _\n    return force\n  }\n\n  return force\n}\n","/*\n * based on the following example\n * https://github.com/rexxars/react-markdown/issues/10#issuecomment-347763068\n */\n\nimport React from 'react'\nimport 'katex/dist/katex.min.css'\nimport ReactMarkdown from 'react-markdown'\nimport remarkMath from 'remark-math'\nimport styled from 'styled-components'\nimport rehypeKatex from 'rehype-katex'\n\nconst Styler = styled.div`\n  img {\n    max-width: 100%;\n  }\n`\n\nexport default function Math({ children }: { children: string }) {\n  const props = {\n    children,\n    remarkPlugins: [remarkMath],\n    rehypePlugins: [rehypeKatex],\n  }\n  return (\n    <Styler>\n      <ReactMarkdown {...props} />\n    </Styler>\n  )\n}\n","import React from 'react'\nimport { highlight, select, selectSelectedNode } from './mathSlice'\nimport Math from './Math'\nimport { useAppDispatch, useAppSelector } from '../../app/hooks'\nimport { GraphNode } from './types'\n\ninterface NodeListProps {\n  title: string\n  nodes: GraphNode[]\n}\n\nconst NodeList: React.FC<NodeListProps> = ({ title, nodes }: NodeListProps) => {\n  const dispatch = useAppDispatch()\n  return (\n    <>\n      <header className=\"card-header\">\n        <p className=\"card-header-title\">\n          {title}: {nodes.length}\n        </p>\n      </header>\n      <section className=\"card-content\">\n        <ul className=\"buttons are-small\">\n          {nodes.map(node => (\n            <li\n              onClick={() => dispatch(select(node.uri))}\n              onMouseEnter={() => dispatch(highlight(node.uri))}\n              onMouseLeave={() => dispatch(highlight(''))}\n              key={node.uri}\n              className=\"button is-link is-inverted\"\n            >\n              {node.label.en}\n            </li>\n          ))}\n        </ul>\n      </section>\n    </>\n  )\n}\n\nconst Statement = () => {\n  const dispatch = useAppDispatch()\n  const onSelectNode = (uri: string) => dispatch(select(uri))\n  const node = useAppSelector(selectSelectedNode)\n\n  const dependencies: GraphNode[] = Object.values(node.dependencies)\n  const dependents: GraphNode[] = Object.values(node.dependents)\n\n  return (\n    <div className=\"card\">\n      <header className=\"card-header\">\n        <p className=\"card-header-title\">\n          <a href={node.uri}>{node.label.en}</a>\n        </p>\n        <span className=\"card-header-icon\">\n          <button\n            className=\"delete\"\n            aria-label=\"close\"\n            onClick={() => onSelectNode('')}\n          >\n            close\n          </button>\n        </span>\n      </header>\n      <section className=\"card-content\">\n        <Math>{node.description.en}</Math>\n      </section>\n      <NodeList title=\"dependencies\" nodes={dependencies} />\n      <NodeList title=\"dependents\" nodes={dependents} />\n    </div>\n  )\n}\n\nexport default Statement\n","import React from 'react'\nimport styled from 'styled-components'\n\nconst ICOutside = styled.div`\n  position: fixed;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  pointer-events: none;\n  overflow-x: hidden;\n  overflow-y: auto;\n`\nconst ICInside = styled.div`\n  pointer-events: all;\n  overflow-x: auto;\n  width: 100%;\n`\n\nconst InfoContainer = ({ children }: { children: React.ReactNode }) => (\n  <ICOutside>\n    <div className=\"columns mr-1 mt-6\">\n      <div className=\"column is-one-quarter is-offset-three-quarters\">\n        <ICInside>{children}</ICInside>\n      </div>\n    </div>\n  </ICOutside>\n)\n\nexport default InfoContainer\n","import { Grid, Matrix, Vector } from '../types'\nimport { VisualizationGraph } from '../types'\nimport { GraphNode } from '../../types'\nimport { SimulationGraph } from '../simulation/types'\nimport numeric from 'numeric'\n\nexport const transform = (matrix: Matrix, vector: Vector): Vector => {\n  const raw = numeric.dot(matrix, numeric.transpose([[...vector, 1]])) as Matrix\n  const [[x], [y]] = raw\n  return [x, y]\n}\n\nexport const nodeRadius = (node: GraphNode): number => {\n  let count = Object.entries(node.dependents).length ?? 0\n  count = count < 1 ? 1 : count\n  return count ** 0.42 * 5\n}\n\nexport const basicGrid: Grid = {\n  origin: [0, 0],\n  distance: 20,\n  highlight: 5,\n}\n\nexport const transformGrid = (matrix: Matrix, grid: Grid): Grid => {\n  let distance = grid.distance * matrix[0][0]\n  while (distance < 20) {\n    distance *= 5\n  }\n  return {\n    origin: transform(matrix, grid.origin),\n    distance,\n    highlight: grid.highlight,\n  }\n}\n\nexport const transformLayout = (\n  matrix: Matrix,\n  graph: SimulationGraph,\n  highlighted: string,\n  selected: string,\n  selectedDependencies: string[],\n): VisualizationGraph => {\n  const transformedNodesDict = Object.fromEntries(\n    graph.nodes.map(node => {\n      const [x, y] = transform(matrix, [node.x, node.y])\n      const r = matrix[0][0] * node.r\n      return [node.uri, { ...node, x, y, r, style: '' }]\n    }),\n  )\n\n  selectedDependencies.forEach(\n    uri => (transformedNodesDict[uri].style = 'focus2'),\n  )\n\n  if (highlighted && transformedNodesDict[highlighted]) {\n    transformedNodesDict[highlighted].style = 'accent'\n  }\n\n  if (selected) {\n    transformedNodesDict[selected].style = 'focus'\n  }\n\n  const links = graph.links.map(link => {\n    const sourceUri =\n      typeof link.source === 'string'\n        ? link.source\n        : typeof link.source === 'number'\n        ? graph.nodes[link.source].uri\n        : link.source.uri\n    const targetUri =\n      typeof link.target === 'string'\n        ? link.target\n        : typeof link.target === 'number'\n        ? graph.nodes[link.target].uri\n        : link.target.uri\n    const source = transformedNodesDict[sourceUri]\n    const target = transformedNodesDict[targetUri]\n    return { source, target }\n  })\n\n  return { nodes: Object.values(transformedNodesDict), links }\n}\n","import React, { useEffect, useState } from 'react'\nimport Visualization from './Visualization'\nimport {\n  highlight,\n  select,\n  selectHighlighted,\n  selectSelected,\n  selectSelectedNodeDependencies,\n} from '../mathSlice'\nimport Simulation from './simulation'\nimport { SimulationGraph, SimulationLink } from './simulation/types'\nimport { Matrix, Vector } from './types'\nimport numeric from 'numeric'\nimport Statement from '../Statement'\nimport { useAppDispatch, useAppSelector } from '../../../app/hooks'\nimport { selectPrunedGraph } from '../mathSlice'\nimport InfoContainer from '../InfoContainer'\nimport {\n  basicGrid,\n  nodeRadius,\n  transform,\n  transformGrid,\n  transformLayout,\n} from './helpers/transform'\n\nconst VisualizationContainer: React.FC = props => {\n  const prunedGraph = useAppSelector(selectPrunedGraph)\n  const highlightedNode = useAppSelector(selectHighlighted)\n  const selectedNode = useAppSelector(selectSelected)\n  const selectedNodeDependencies = useAppSelector(\n    selectSelectedNodeDependencies,\n  )\n  const dispatch = useAppDispatch()\n\n  const [simulation] = useState(new Simulation())\n  const [layout, setLayout] = useState<SimulationGraph>({\n    nodes: [],\n    links: [],\n  })\n  // transformation matrix\n  const [matrix, setMatrix] = useState<Matrix>([\n    [1, 0, 0],\n    [0, 1, 0],\n    [0, 0, 1],\n  ])\n\n  // initialize simulation\n  useEffect(() => {\n    let lastUpdate = Date.now() - 20\n    simulation.start({\n      nodes: [],\n      links: [],\n      onTick: ({ nodes, links }) => {\n        const now = Date.now()\n        if (now > lastUpdate + 20) {\n          setLayout({ nodes: [...nodes], links: [...links] })\n          lastUpdate = now\n        }\n      },\n    })\n    return () => {\n      simulation.stop()\n    }\n  }, [simulation])\n\n  // when graph changes, update simulation\n  useEffect(() => {\n    const nodes = Object.values(prunedGraph).map(node => ({\n      label: node.label.en,\n      x: Math.random() * 400,\n      y: Math.random() * 400,\n      r: nodeRadius(node),\n      uri: node.uri,\n    }))\n\n    const links: SimulationLink[] = Object.values(prunedGraph).reduce(\n      (links, { uri: source, dependencies }) => {\n        Object.keys(dependencies).forEach(target =>\n          links.push({ source, target }),\n        )\n        return links\n      },\n      [] as SimulationLink[],\n    )\n\n    simulation.update({ nodes, links })\n  }, [prunedGraph, simulation])\n\n  const handleTransform = (matrix: Matrix): void => {\n    setMatrix(prevMatrix => numeric.dot(matrix, prevMatrix) as Matrix)\n  }\n\n  const withNode = (action: (uri: string) => unknown) => {\n    return (position: Vector): void => {\n      // first transform to local coordinates\n      const [x, y] = transform(numeric.inv(matrix), position)\n      // then find the node in simulation\n      action(simulation.selectNode({ x, y })?.uri)\n    }\n  }\n\n  const handleHover = withNode(uri => dispatch(highlight(uri)))\n  const handleSelect = withNode(uri => dispatch(select(uri)))\n\n  // transform layout to TransformedLayout\n  const transformedLayout = transformLayout(\n    matrix,\n    layout,\n    highlightedNode,\n    selectedNode,\n    selectedNodeDependencies,\n  )\n\n  const grid = transformGrid(matrix, basicGrid)\n\n  return (\n    <>\n      <Visualization\n        graph={transformedLayout}\n        grid={grid}\n        onTransform={handleTransform}\n        onHover={handleHover}\n        onSelectNode={handleSelect}\n        {...props}\n      />\n\n      {\n        // @TODO maybe move this stuff out, it's more of a Layout component\n      }\n      <InfoContainer>{selectedNode && <Statement />}</InfoContainer>\n    </>\n  )\n}\n\nexport default VisualizationContainer\n","import React from 'react'\nimport styled from 'styled-components'\n\nconst Link = styled.a`\n  color: lightgray;\n  &:hover {\n    color: white;\n  }\n`\nconst Footer = styled.footer`\n  color: gray;\n`\n\nconst About: React.FC = props => (\n  <div {...props}>\n    <Footer>\n      powered by <Link href=\"https://solidproject.org\">Solid</Link> &middot;{' '}\n      <Link href=\"https://github.com/livegraph-org/solid-math\">source</Link>\n    </Footer>\n  </div>\n)\n\nexport default About\n","import React from 'react'\nimport AppButton from '../../components/AppButton'\n\nconst ControlPanel: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({\n  ...props\n}) => (\n  <div {...props}>\n    <AppButton\n      aria-label=\"people\"\n      onClick={() => alert('people control not implemented')}\n    >\n      <i className=\"icon icon-users\" />\n    </AppButton>\n    <AppButton onClick={() => alert('document control not implemented')}>\n      <i className=\"icon icon-document\" aria-label=\"documents\" />\n    </AppButton>\n    <AppButton\n      onClick={() => alert('adding documents and math not implemented')}\n    >\n      <i className=\"icon icon-plus\" aria-label=\"add\" />\n    </AppButton>\n  </div>\n)\n\nexport default ControlPanel\n","import { createSelector, createSlice, PayloadAction } from '@reduxjs/toolkit'\nimport { RootState } from '../../app/store'\nimport { selectGraph } from '../math/mathSlice'\nimport { Graph } from '../math/types'\n\ninterface SearchState {\n  query: string\n}\n\nconst initialState: SearchState = {\n  query: '',\n}\n\nexport const searchSlice = createSlice({\n  name: 'search',\n  initialState,\n  reducers: {\n    setSearch: (state, action: PayloadAction<string>) => {\n      state.query = action.payload\n    },\n  },\n})\n\nexport const { setSearch } = searchSlice.actions\n\n// Selectors\nexport const selectSearch = (state: RootState) => state.search.query\n\nexport const selectSearchResults = createSelector(\n  selectSearch,\n  selectGraph,\n  (query: string, graph: Graph): { label: string; value: string }[] => {\n    if (query.length < 2) return []\n    return Object.values(graph)\n      .filter(\n        ({ label }) => label.en.toLowerCase().includes(query.toLowerCase()),\n        //*|| uri.toLowerCase().includes(query.toLowerCase()),\n      )\n      .sort(\n        ({ dependents: a }, { dependents: b }) =>\n          Object.values(b).length - Object.values(a).length,\n      )\n      .map(({ uri, label: { en: label } }) => ({ value: uri, label }))\n      .slice(0, 10)\n  },\n)\n\nexport default searchSlice.reducer\n","import React, { HTMLAttributes, useState } from 'react'\nimport { useCallback } from 'react'\nimport { useEffect } from 'react'\nimport { useAppDispatch, useAppSelector } from '../../app/hooks'\nimport AppButton from '../../components/AppButton'\nimport { highlight, select } from '../math/mathSlice'\nimport { selectSearch, selectSearchResults, setSearch } from './searchSlice'\n\nconst Search: React.FC<HTMLAttributes<HTMLDivElement>> = ({ ...props }) => {\n  const value = useAppSelector(selectSearch)\n  const options = useAppSelector(selectSearchResults)\n  const dispatch = useAppDispatch()\n  const [open, setOpen] = useState(false)\n\n  const clear = useCallback(() => {\n    setOpen(false)\n    dispatch(setSearch(''))\n  }, [dispatch])\n\n  useEffect(() => {\n    const handleEsc = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        clear()\n      }\n    }\n    document.addEventListener('keydown', handleEsc, false)\n    return () => document.removeEventListener('keydown', handleEsc, false)\n  }, [clear])\n\n  return open ? (\n    <div {...props} className=\"box p-0\">\n      <p className=\"control has-icons-right\">\n        <input\n          autoFocus\n          type=\"text\"\n          className=\"input\"\n          placeholder=\"Search\"\n          value={value}\n          onChange={e => dispatch(setSearch(e.target.value))}\n        />\n        <span className=\"icon is-right\">\n          <i className=\"icon icon-search\" />\n        </span>\n      </p>\n      <div className=\"menu\">\n        <ul className=\"menu-list\">\n          {options.map(({ value, label }) => (\n            <li\n              key={value}\n              title={value}\n              onMouseEnter={() => dispatch(highlight(value))}\n              onMouseLeave={() => dispatch(highlight(''))}\n            >\n              <a\n                onClick={() => {\n                  dispatch(select(value))\n                  clear()\n                }}\n              >\n                {label}\n              </a>\n            </li>\n          ))}\n        </ul>\n      </div>\n    </div>\n  ) : (\n    <AppButton onClick={() => setOpen(true)}>\n      <i className=\"icon icon-search\" />\n    </AppButton>\n  )\n}\n\nexport default Search\n","import React from 'react'\nimport Login from '../features/login/Login'\nimport VisualizationContainer from '../features/math/visualization/VisualizationContainer'\nimport styled from 'styled-components'\nimport About from './About'\nimport ControlPanel from '../features/control/ControlPanel'\nimport Search from '../features/search/Search'\n\nconst PositionedAbout = styled(About)`\n  position: fixed;\n  bottom: 1rem;\n  right: 1rem;\n`\n\nconst FullSizeVisualization = styled(VisualizationContainer)`\n  height: 100vh;\n  width: 100vw;\n  display: block;\n`\n\nconst TopNav = styled.nav`\n  display: flex;\n  position: absolute;\n  width: 100%;\n  pointer-events: none;\n  justify-content: space-between;\n  & > * {\n    pointer-events: all;\n  }\n  padding: 1rem;\n`\n\nconst Layout: React.FC = () => {\n  return (\n    <>\n      <TopNav>\n        <ControlPanel />\n        <div style={{ display: 'flex' }}>\n          <Search\n            style={{\n              display: 'inline-block',\n              position: 'relative',\n              zIndex: 2,\n            }}\n          />\n          <Login />\n        </div>\n      </TopNav>\n\n      <PositionedAbout />\n\n      <FullSizeVisualization />\n    </>\n  )\n}\n\nexport default Layout\n","import React, { useEffect } from 'react'\nimport Layout from './components/Layout'\nimport { init as initLogin } from './features/login/loginSlice'\nimport { useAppDispatch } from './app/hooks'\n\nconst App: React.FC = () => {\n  const dispatch = useAppDispatch()\n  useEffect(() => {\n    dispatch(initLogin())\n  }, [dispatch])\n\n  return <Layout />\n}\n\nexport default App\n","import { configureStore, ThunkAction, Action } from '@reduxjs/toolkit'\nimport loginReducer from '../features/login/loginSlice'\nimport mathReducer from '../features/math/mathSlice'\nimport searchReducer from '../features/search/searchSlice'\n\nexport const store = configureStore({\n  reducer: {\n    login: loginReducer,\n    math: mathReducer,\n    search: searchReducer,\n  },\n})\n\nexport type AppDispatch = typeof store.dispatch\nexport type RootState = ReturnType<typeof store.getState>\nexport type AppThunk<ReturnType = void> = ThunkAction<\n  ReturnType,\n  RootState,\n  unknown,\n  Action<string>\n>\n","import { ReportHandler } from 'web-vitals'\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.scss'\nimport './fonts/fontello/css/fontello.css'\nimport './fonts/animation.css'\nimport App from './App'\nimport { store } from './app/store'\nimport reportWebVitals from './reportWebVitals'\nimport { Provider } from 'react-redux'\nimport Modal from 'react-modal'\n\nif (typeof document === 'object') {\n  const appElement = document.querySelector('#root') as HTMLElement\n\n  Modal.setAppElement(appElement)\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root'),\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}